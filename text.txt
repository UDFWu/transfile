private void run(StepContribution contribution, LocalDate runDate) {

        // 取得整批代收來源檔
        MidLogUtils.addInfoLog("開始取得 券商主檔來源檔");
        List<DepEwHBrokerEntity> brokerList = repository.findBrokerList();

        //颱風天處理
        //boolean isTyphon = isTyphon(runDate);

        Map<String, EwbBat8OutputDto> outputMap = new HashMap<>();
        for (DepEwHBrokerEntity scu : brokerList) {
            EwbBat8OutputDto output = new EwbBat8OutputDto();
            output.setFutCod(scu.getId());
            output.setTlrId(scu.getLInputter());
            output.setName(scu.getDescription());
            output.setBranch(scu.getStockBrokerLegalId());
            output.setMainComp(scu.getParentStockCompany());
        }

        StringBuilder outputContent = new StringBuilder();
        //組成回饋檔
        FixedFormatLineAggregator<EwbBat8OutputDto> fixedFormatLineAggregator = new FixedFormatLineAggregator<>();
        for (Map.Entry<String, EwbBat8OutputDto> entry : outputMap.entrySet()) {
            EwbBat8OutputDto output = entry.getValue();
            validate(output);
            outputContent.append(fixedFormatLineAggregator.aggregate(output)).append("\n");
        }
        writeToFile("FNMSC0_SCU", outputContent.toString());
    }

    private void validate(EwbBat8OutputDto output) {

        try {
            return;
        } catch (TxnException e) {
            //IF  Not Found  -> MOVE 'E001'   to  "處理訊息"欄位
            //output.setPrsCod("E001");
            return;
        }
    }

    private void writeToFile(String fileName, String content) {
        try {
            Path path = Paths.get("D:/{}.txt", fileName);
            Files.writeString(path, content); // 自動處理流的開關
            //sftpClient.send(eftExportFilepath, fileName, content.getBytes());
        } catch (Exception e) {
            MidLogUtils.addWarnLog("上傳 {} 檔案至 {} 失敗, error: {}", fileName, eftExportFilepath, e);
            MidMessageUtils.raiseTxError(CodeEnum.DEPDS010, fileName);
        }
    }