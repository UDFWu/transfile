[DEBUG] Visiting unlts/target/unlts.war/WEB-INF/lib-provided/jakarta.servlet-api-6.0.0.jar/module-info.class
[DEBUG] Closing directory /datam/jenkins/workspace/Pipeline_Sample/nexus_evaluate/unlts/target/unlts.war/WEB-INF/lib-provided/jakarta.servlet-api-6.0.0.jar
[DEBUG] Visiting unlts/target/unlts.war/WEB-INF/classpath.idx
[DEBUG] Visiting unlts/target/unlts.war/WEB-INF/layers.idx
[DEBUG] Closing directory /datam/jenkins/workspace/Pipeline_Sample/nexus_evaluate/unlts/target/unlts.war
[DEBUG] 2025-11-19T14:32:07.887+08:00 Finished scanning target: /datam/jenkins/workspace/Pipeline_Sample/nexus_evaluate/unlts/target/unlts.war
[INFO] 2025-11-19T14:32:07.887+08:00 Scanned 49871 total files
[DEBUG] Writing scan summary
[DEBUG] Closing scan tag
[DEBUG] Closing writer
[INFO] 2025-11-19T14:32:07.888+08:00 Finished scanning application unlts.
[DEBUG] Unable to find repository URL via environment variable GIT_URL
[DEBUG] Unable to find repository URL via jGit
[INFO] Could not discover git repository url via automation
[DEBUG] Repository URL for application with id: unlts could not be found using automation
[DEBUG] Running policy evaluation.
[DEBUG] Assigned status ID 4dcd769ab6dd401ab65b1506ca83170d for evaluation
[INFO] Waiting for policy evaluation to complete...
[DEBUG] Checking evaluation status at Wed Nov 19 14:32:08 CST 2025
[DEBUG] Checking evaluation status at Wed Nov 19 14:38:57 CST 2025


 stage('Nexus Evaluate') { 
            steps {
                nexusPolicyEvaluation (
                    advancedProperties: '', //預設空白
                    enableDebugLogging: true, //是否開啟Debug log
                    failBuildOnNetworkError: true, //如果連不上IQ Server 是否中斷 build
                    iqApplication: 'unlts', //指定哪一個 IQ Server application 做掃描 (Gitlab Project Name)
                    iqInstanceId: 'sonatype-dev', //Jenkins server 的 IQ server 使用者
                    iqScanPatterns: [[scanPattern: '**/target/*.jar'], [scanPattern: '**/target/*.war']], //要掃描的檔案路徑(這裡指掃描所有Target下面的 Jar file)
                    iqStage: 'build',
                    jobCredentialsId: 'sonatype-lifecycle-scan' 
                )
            }
            post {
                failure {
                    echo '偵測到違規中高風險檔案，中斷 pipeline 執行，請至 Build# Log 中查看掃描報告。'
                }
                success {
                    echo '掃描成功，沒有偵測到違規風險檔案。'
                }
            }
        } 