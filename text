stage('Checkmarx Scan') {
            steps {
                script {
                    withCredentials([usernamePassword(credentialsId: "${CX_CREDENTIALS_ID}", usernameVariable: 'CX_USER', passwordVariable: 'CX_PASSWORD')]) {
                        // 使用 Checkmarx 插件的 CxScanBuilder 來執行掃描
                        step([
                            $class: 'CxScanBuilder',
                            serverUrl: "${CX_URL}",
                            projectName: "${PROJECT_NAME}",
                            fullScanCycle: true,
                            incremental: false,
                            credentialsId: "${CX_CREDENTIALS_ID}",
                            avoidDuplicateProjectScans: true,
                            generatePdfReport: true,
                            enablePDFReport: true,
                            waitForResultsEnabled: true,
                            vulnerabilityThresholdEnabled: false,  // 根據需求設置
                            scanPreset: 'Checkmarx Default'  // 使用預設掃描配置
                        ])
                    }
                }
            }
        }