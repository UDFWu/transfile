pipeline {
    agent any

    tools { 
      maven 'Apache Maven 3.9.6' 
      jdk 'jdk17' 
      dependencyCheck 'OWASP_Dependency_Check'
    }
    
    environment { 
        GITLAB_URL = 'git@10.10.32.10:michael/cicd-form-backend.git'
        SONAR_SCANNER_NAME = 'sonar-scanner'
        SONAR_SERVER_NAME = 'sonar-server'
        SONAR_SCANNER_HOME = '/var/jenkins_home/sonar-scanner/bin/sonar-scanner'  // 指定 SonarScanner 的安裝路徑
        SONARQUBE_TOKEN = credentials('sonar-server-token')
        SONARQUBE_SERVER = 'http://10.10.32.10:9000'
    }

    stages {
        stage('Checkout') {
            steps {
                script {
                    checkout([$class: 'GitSCM',
                    branches: [[name: "main"]],
                    userRemoteConfigs: [[url: "${GITLAB_URL}", credentialsId: 'ssh-key']]
                    ])
                }
            }
        }
        
        stage('SonarQube Analysis') {
            steps {
                script {
                        // 使用 SonarScanner 進行代碼掃描
                    withCredentials([string(credentialsId: 'sonar-server-token', variable: 'SONARQUBE_TOKEN')]) {
                        withSonarQubeEnv("${SONAR_SERVER_NAME}") {
                            sh "${SONAR_SCANNER_NAME} -Dsonar.login=\$SONARQUBE_TOKEN -Dsonar.host.url=${SONARQUBE_SERVER}"
                        }
                    }
                }
                
            }
            
        }
        
        stage('OWASP Analysis') {
            steps {
                dependencyCheck additionalArguments: '',
                                odcInstallation: 'OWASP_Dependency_Check',
                                scanPath: '/var/lib/jenkins/workspace/e-form-backend-test',
                                failOnCVSS: '7',
                                failBuildOnCVSS: true
                
            }
            
        }
        
    }
}







Started by user admin
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
WorkflowScript: 50: Invalid parameter "scanPath", did you mean "stopBuild"? @ line 50, column 33.
                                   scanPath: '/var/lib/jenkins/workspace/e-form-backend-test',
                                   ^

WorkflowScript: 51: Invalid parameter "failOnCVSS", did you mean "stopBuild"? @ line 51, column 33.
                                   failOnCVSS: '7',
                                   ^

WorkflowScript: 52: Invalid parameter "failBuildOnCVSS", did you mean "stopBuild"? @ line 52, column 33.
                                   failBuildOnCVSS: true
                                   ^

WorkflowScript: 7: Invalid tool type "dependencyCheck". Valid tool types: [ant, hudson.tasks.Ant$AntInstallation, dependency-check, org.jenkinsci.plugins.DependencyCheck.tools.DependencyCheckInstallation, git, hudson.plugins.git.GitTool, gradle, hudson.plugins.gradle.GradleInstallation, jdk, hudson.model.JDK, jgit, org.jenkinsci.plugins.gitclient.JGitTool, jgitapache, org.jenkinsci.plugins.gitclient.JGitApacheTool, maven, hudson.tasks.Maven$MavenInstallation, hudson.plugins.sonar.SonarRunnerInstallation, hudson.plugins.sonar.MsBuildSQRunnerInstallation] @ line 7, column 7.
         dependencyCheck 'OWASP_Dependency_Check'
         ^

4 errors