pipeline {
    agent any

    tools { 
      maven 'Apache Maven 3.9.6' 
      jdk 'jdk17' 
      'dependency-check' 'OWASP_Dependency_Check'
    }
    
    environment { 
        GITLAB_URL = 'git@10.10.32.10:michael/cicd-form-backend.git'
        SONAR_SCANNER_NAME = 'sonar-scanner'
        SONAR_SERVER_NAME = 'sonar-server'
        SONAR_SCANNER_HOME = '/var/jenkins_home/sonar-scanner/bin/sonar-scanner'  // 指定 SonarScanner 的安裝路徑
        SONARQUBE_TOKEN = credentials('sonar-server-token')
        SONARQUBE_SERVER = 'http://10.10.32.10:9000'
    }

    stages {
        stage('Checkout') {
            steps {
                script {
                    checkout([$class: 'GitSCM',
                    branches: [[name: "main"]],
                    userRemoteConfigs: [[url: "${GITLAB_URL}", credentialsId: 'ssh-key']]
                    ])
                }
            }
        }
        
        stage('SonarQube Analysis') {
            steps {
                script {
                        // 使用 SonarScanner 進行代碼掃描
                    withCredentials([string(credentialsId: 'sonar-server-token', variable: 'SONARQUBE_TOKEN')]) {
                        withSonarQubeEnv("${SONAR_SERVER_NAME}") {
                            sh "${SONAR_SCANNER_NAME} -Dsonar.login=\$SONARQUBE_TOKEN -Dsonar.host.url=${SONARQUBE_SERVER}"
                        }
                    }
                }
                
            }
            
        }
        
        stage('OWASP Analysis') {
            steps {
                dependencyCheck arguments: '''
                                -o './'
                                -s '/var/lib/jenkins/workspace/e-form-backend-test'
                                -f 'ALL'
                                --prettyPrint''',
                                odcInstallation: 'OWASP_Dependency_Check'
                
            }
            
        }
        
    }
}


Started by user admin
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
WorkflowScript: 58: unexpected token: } @ line 58, column 13.
               }
               ^

1 error

	at org.codehaus.groovy.control.ErrorCollector.failIfErrors(ErrorCollector.java:309)
	at org.codehaus.groovy.control.ErrorCollector.addFatalError(ErrorCollector.java:149)
	at org.codehaus.groovy.control.ErrorCollector.addError(ErrorCollector.java:119)
	at org.codehaus.groovy.control.ErrorCollector.addError(ErrorCollector.java:131)
	at org.codehaus.groovy.control.SourceUnit.addError(SourceUnit.java:349)
	at org.codehaus.groovy.antlr.AntlrParserPlugin.transformCSTIntoAST(AntlrParserPlugin.java:225)
	at org.codehaus.groovy.antlr.AntlrParserPlugin.parseCST(AntlrParserPlugin.java:191)
	at org.codehaus.groovy.control.SourceUnit.parse(SourceUnit.java:233)
	at org.codehaus.groovy.control.CompilationUnit$1.call(CompilationUnit.java:189)
	at org.codehaus.groovy.control.CompilationUnit.applyToSourceUnits(CompilationUnit.java:966)
	at org.codehaus.groovy.control.CompilationUnit.doPhaseOperation(CompilationUnit.java:626)
	at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:602)
	at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:579)
	at groovy.lang.GroovyClassLoader.doParseClass(GroovyClassLoader.java:323)
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:293)
	at org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.GroovySandbox$Scope.parse(GroovySandbox.java:163)
	at org.jenkinsci.plugins.workflow.cps.CpsGroovyShell.doParse(CpsGroovyShell.java:190)
	at org.jenkinsci.plugins.workflow.cps.CpsGroovyShell.reparse(CpsGroovyShell.java:175)
	at org.jenkinsci.plugins.workflow.cps.CpsFlowExecution.parseScript(CpsFlowExecution.java:636)
	at org.jenkinsci.plugins.workflow.cps.CpsFlowExecution.start(CpsFlowExecution.java:582)
	at org.jenkinsci.plugins.workflow.job.WorkflowRun.run(WorkflowRun.java:335)
	at hudson.model.ResourceController.execute(ResourceController.java:101)
	at hudson.model.Executor.run(Executor.java:442)
[withMaven] downstreamPipelineTriggerRunListener - Failure to introspect build steps: java.io.IOException: cicd-form/cicd-form-backend #13 did not yet start
[withMaven] downstreamPipelineTriggerRunListener - Failure to introspect build steps: java.io.IOException: cicd-form/cicd-form-backend #13 did not yet start
Finished: FAILURE